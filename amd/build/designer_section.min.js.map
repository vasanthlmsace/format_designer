{"version":3,"sources":["../src/designer_section.js"],"names":["define","$","Ajax","Loadingicon","editor","Actions","DesignerSection","courseId","contextId","self","courseeditor","getCurrentCourseEditor","delegate","SectionController","sectionLayoutaction","bind","sectionRestricted","sectionRestrictHandler","moduleBlock","moduleHandler","moduleDescription","modcontentHandler","prototype","SectionLayoutController","RestrictInfo","loadingElement","activityli","ulclasses","event","sectionRestrictInfo","currentTarget","parent","hasClass","addClass","removeClass","sectionId","target","closest","getAttribute","dataid","layout","data","layouttext","text","parents","find","html","val","each","cms","length","iconBlock","args","courseid","sectionid","options","name","value","promises","call","methodname","when","apply","done","sectionpromise","refreshSection","then","catch","addIconToContainerRemoveOnCompletion","preventDefault","restrictBlock","THIS","fullContent","init"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Implemented designer format js.\n *\n * @module     format_designer/designer_section\n * @copyright  2021 bdecent gmbh <https://bdecent.de>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n define(['jquery', 'core/ajax', 'core/loadingicon', 'core_courseformat/courseeditor', 'core_course/actions'],\n function($, Ajax, Loadingicon, editor, Actions) {\n\n    /**\n     * Control designer format action\n     * @param {int} courseId\n     * @param {int} contextId\n     */\n    let DesignerSection = function(courseId, contextId) {\n        var self = this;\n        self.courseeditor = editor.getCurrentCourseEditor();\n        self.courseId = courseId;\n        self.contextId = contextId;\n        $('body').delegate(self.SectionController, 'click', self.sectionLayoutaction.bind(this));\n        $('body').delegate(self.sectionRestricted, \"click\", this.sectionRestrictHandler.bind(this));\n        $('body').delegate(self.moduleBlock, \"click\", self.moduleHandler.bind(this));\n        $('body').delegate(self.moduleDescription, \"click\", self.modcontentHandler.bind(this));\n    };\n\n        /**\n         * Selector section controller.\n         */\n         DesignerSection.prototype.SectionController = \".designer #section-designer-action .dropdown-menu a\";\n\n         DesignerSection.prototype.SectionLayoutController = \".designer #section-designer-action .dropdown-menu a\";\n\n         DesignerSection.prototype.RestrictInfo = \".designer #designer-section-content .call-action-block\";\n\n         DesignerSection.prototype.loadingElement = \".icon-loader-block\";\n\n         DesignerSection.prototype.sectionRestricted = \".designer .restricted-section-block .section-restricted-action\";\n\n         DesignerSection.prototype.activityli = \"li.activity\";\n\n         DesignerSection.prototype.ulclasses = {\n             'cards': 'card-deck card-layout',\n             'list': 'list-layout',\n             'default': ''\n         };\n\n        DesignerSection.prototype.moduleBlock = \".designer #designer-section-content li.activity\";\n        DesignerSection.prototype.moduleDescription = \".designer #designer-section-content li .mod-description-action\";\n\n    DesignerSection.prototype.sectionRestrictHandler = function(event) {\n        var sectionRestrictInfo = $(event.currentTarget).parent();\n        if (sectionRestrictInfo) {\n            if (!sectionRestrictInfo.hasClass('show')) {\n                sectionRestrictInfo.addClass('show');\n            } else {\n                sectionRestrictInfo.removeClass('show');\n            }\n        }\n    };\n\n    /**\n     * Implementaion swith the section layout.\n     * @param {object} event\n     */\n    DesignerSection.prototype.sectionLayoutaction = function(event) {\n        var self = this;\n        let sectionId = event.target.closest('li.section').getAttribute('id');\n        let dataid = event.target.closest('li.section').getAttribute('data-id');\n        var layout = $(event.currentTarget).data('value');\n        var layouttext = $(event.currentTarget).text();\n        $(event.target).parents(\".dropdown\").find(\".btn\").html(layouttext);\n        $(event.target).parents(\".dropdown\").find(\".btn\").val(layout);\n        $(event.target).parent().find(\"a.dropdown-item\").each(function() {\n            $(this).removeClass('active');\n        });\n        $(event.target).addClass('active');\n        let cms = $(\"#\" + sectionId).find('ul#designer-section-content li').length;\n        if (cms) {\n\n            var iconBlock = \"#\" + sectionId + \" \" + self.loadingElement;\n            var args = {\n                courseid: self.courseId,\n                sectionid: dataid,\n                options: [{name: $(event.currentTarget).data('option'), value: layout}]\n            };\n            var promises = Ajax.call([{\n                methodname: 'format_designer_set_section_options',\n                args: args\n            }], true);\n            $.when.apply($, promises)\n            .done(function() {\n                const sectionpromise = Actions.refreshSection('#' + sectionId, dataid, 0);\n                sectionpromise.then(() => {\n                   return '';\n                }).catch();\n            });\n            Loadingicon.addIconToContainerRemoveOnCompletion(iconBlock, promises);\n        }\n    };\n\n\n    DesignerSection.prototype.moduleHandler = function(event) {\n        if ($(event.target).hasClass('fa-lock')) {\n            event.preventDefault();\n            var restrictBlock = $(event.currentTarget).find(\".restrict-block\");\n            if (restrictBlock) {\n                if (!restrictBlock.hasClass('show')) {\n                    restrictBlock.addClass('show');\n                } else {\n                    restrictBlock.removeClass('show');\n                }\n            }\n        }\n    };\n\n    DesignerSection.prototype.modcontentHandler = function(event) {\n        var THIS = $(event.currentTarget);\n        var fullContent = $(THIS).parent();\n        if (fullContent.hasClass('summary-hide')) {\n            fullContent.removeClass('summary-hide');\n            $(THIS).text(\"Less\");\n        } else {\n            fullContent.addClass('summary-hide');\n            $(THIS).text(\"More\");\n        }\n    };\n\n\n    return {\n        init: function(courseId, contextId) {\n            return new DesignerSection(courseId, contextId);\n        }\n    };\n});"],"file":"designer_section.min.js"}