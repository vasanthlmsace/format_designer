{"version":3,"sources":["../src/designer_section.js"],"names":["define","$","Ajax","Loadingicon","editor","Actions","DesignerSection","courseId","contextId","self","courseeditor","getCurrentCourseEditor","delegate","SectionController","sectionLayoutaction","bind","sectionRestricted","sectionRestrictHandler","moduleBlock","moduleHandler","moduleDescription","modcontentHandler","prototype","SectionLayoutController","RestrictInfo","loadingElement","activityli","ulclasses","event","sectionRestrictInfo","currentTarget","parent","hasClass","addClass","removeClass","sectionId","target","closest","getAttribute","dataid","datasectionid","layout","data","layouttext","text","parents","find","html","val","each","cms","length","iconBlock","sectionnumber","args","courseid","sectionid","options","name","value","promises","call","methodname","when","apply","done","sectionpromise","refreshSection","then","catch","addIconToContainerRemoveOnCompletion","preventDefault","restrictBlock","THIS","fullContent","prevAll","trimContent","moreLessTxt","is","slideToggle","init"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Implemented designer format js.\n *\n * @module     format_designer/designer_section\n * @copyright  2021 bdecent gmbh <https://bdecent.de>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n define(['jquery', 'core/ajax', 'core/loadingicon', 'core_courseformat/courseeditor', 'core_course/actions', 'core/reactive'],\n function($, Ajax, Loadingicon, editor, Actions, React) {\n\n    /**\n     * Control designer format action\n     * @param {int} courseId\n     * @param {int} contextId\n     */\n    let DesignerSection = function(courseId, contextId) {\n        var self = this;\n        self.courseeditor = editor.getCurrentCourseEditor();\n        self.courseId = courseId;\n        self.contextId = contextId;\n\n        $('body').delegate(self.SectionController, 'click', self.sectionLayoutaction.bind(this));\n        $('body').delegate(self.sectionRestricted, \"click\", this.sectionRestrictHandler.bind(this));\n        $('body').delegate(self.moduleBlock, \"click\", self.moduleHandler.bind(this));\n        $('body').delegate(self.moduleDescription, \"click\", self.modcontentHandler.bind(this));\n    };\n\n        /**\n         * Selector section controller.\n         */\n         DesignerSection.prototype.SectionController = \".designer #section-designer-action .dropdown-menu a\";\n\n         DesignerSection.prototype.SectionLayoutController = \".designer #section-designer-action .dropdown-menu a\";\n\n         DesignerSection.prototype.RestrictInfo = \".designer #designer-section-content .call-action-block\";\n\n         DesignerSection.prototype.loadingElement = \".icon-loader-block\";\n\n         DesignerSection.prototype.sectionRestricted = \".designer .restricted-section-block .section-restricted-action\";\n\n         DesignerSection.prototype.activityli = \"li.activity\";\n\n         DesignerSection.prototype.ulclasses = {\n             'cards': 'card-deck card-layout',\n             'list': 'list-layout',\n             'default': ''\n         };\n\n        DesignerSection.prototype.moduleBlock = \".designer #designer-section-content li.activity\";\n        DesignerSection.prototype.moduleDescription = \".designer #designer-section-content li .mod-description-action\";\n\n    DesignerSection.prototype.sectionRestrictHandler = function(event) {\n        var sectionRestrictInfo = $(event.currentTarget).parent();\n        if (sectionRestrictInfo) {\n            if (!sectionRestrictInfo.hasClass('show')) {\n                sectionRestrictInfo.addClass('show');\n            } else {\n                sectionRestrictInfo.removeClass('show');\n            }\n        }\n    };\n\n    var SELECTOR = {\n        ACTIVITYLI: 'li.activity',\n        SECTIONLI: 'li.section',\n        SECTIONACTIONMENU: '.section_action_menu',\n        ACTIVITYACTION: 'a.cm-edit-action',\n    };\n\n    /**\n     * Implementaion swith the section layout.\n     * @param {object} event\n     */\n    DesignerSection.prototype.sectionLayoutaction = function(event) {\n        var self = this;\n        let sectionId = event.target.closest('li.section').getAttribute('id');\n        let dataid = event.target.closest('li.section').getAttribute('data-id');\n        let datasectionid = event.target.closest('li.section').getAttribute('data-sectionid');\n        var layout = $(event.currentTarget).data('value');\n        var layouttext = $(event.currentTarget).text();\n        $(event.target).parents(\".dropdown\").find(\".btn\").html(layouttext);\n        $(event.target).parents(\".dropdown\").find(\".btn\").val(layout);\n        $(event.target).parent().find(\"a.dropdown-item\").each(function() {\n            $(this).removeClass('active');\n        });\n        $(event.target).addClass('active');\n        let cms = $(\"#\" + sectionId).find('ul#designer-section-content li').length;\n        if (cms) {\n\n            var iconBlock = \"#\" + sectionId + \" \" + self.loadingElement;\n            let sectionnumber = event.target.closest('li.section').getAttribute('data-sectionid');\n            var args = {\n                courseid: self.courseId,\n                sectionid: dataid,\n                options: [{ name: $(event.currentTarget).data('option'), value: layout }]\n            };\n            var promises = Ajax.call([{\n                methodname: 'format_designer_set_section_options',\n                args: args\n            }], true);\n            $.when.apply($, promises)\n            .done(function(dataencoded) {\n                const sectionpromise = Actions.refreshSection('#'+sectionId , dataid, 0);\n                sectionpromise.then(() => {\n                   return '';\n                }).catch();\n            });\n            Loadingicon.addIconToContainerRemoveOnCompletion(iconBlock, promises);\n\n        }\n    };\n\n\n    DesignerSection.prototype.moduleHandler = function(event) {\n        if ($(event.target).hasClass('fa-lock')) {\n            event.preventDefault();\n            var restrictBlock = $(event.currentTarget).find(\".restrict-block\");\n            if (restrictBlock) {\n                if (!restrictBlock.hasClass('show')) {\n                    restrictBlock.addClass('show');\n                } else {\n                    restrictBlock.removeClass('show');\n                }\n            }\n        }\n    };\n\n    DesignerSection.prototype.modcontentHandler = function(event) {\n        var THIS = $(event.currentTarget);\n        var fullContent = $(THIS).prevAll('.fullcontent-summary');\n        var trimContent = $(THIS).prevAll('.trim-summary');\n        var moreLessTxt = fullContent.is(':visible') ? 'More' : 'Less';\n        $(THIS).text(moreLessTxt);\n        fullContent.slideToggle(200);\n        trimContent.slideToggle(200);\n    };\n\n\n    return {\n        init: function(courseId, contextId) {\n            return new DesignerSection(courseId, contextId);\n        }\n    };\n});"],"file":"designer_section.min.js"}