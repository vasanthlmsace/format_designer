{"version":3,"file":"designer_section.min.js","sources":["../src/designer_section.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * Implemented designer format js.\r\n *\r\n * @module     format_designer/designer_section\r\n * @copyright  2021 bdecent gmbh <https://bdecent.de>\r\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\n define(['jquery', 'core/fragment', 'core/templates', 'core/loadingicon', 'core/ajax', 'core_message/toggle_contact_button'],\r\n function($, Fragment, Templates, Loadingicon, Ajax, Contact) {\r\n\r\n    var SELECTOR = {\r\n        ACTIVITYLI: 'li.activity',\r\n        SECTIONLI: 'li.section',\r\n        ACTIVITYACTION: 'a.cm-edit-action',\r\n        SECTIONACTIONMENU: '.section_action_menu.designer-menu',\r\n    };\r\n\r\n    Y.use('moodle-course-coursebase', function() {\r\n        var courseformatselector = M.course.format.get_section_selector();\r\n        if (courseformatselector) {\r\n            SELECTOR.SECTIONLI = courseformatselector;\r\n        }\r\n    });\r\n\r\n    /**\r\n     * Control designer format action\r\n     * @param {int} courseId\r\n     * @param {int} contextId\r\n     * @param {bool} popupActivities\r\n     */\r\n    let DesignerSection = function(courseId, contextId, popupActivities) {\r\n        var self = this;\r\n        self.courseId = courseId;\r\n        self.contextId = contextId;\r\n        self.popupActivities = popupActivities;\r\n\r\n        $(\".course-info-block .carousel .carousel-item:nth-child(1)\").addClass('active');\r\n        $(\".course-info-block #courseStaffinfoControls.carousel\").addClass('active');\r\n\r\n        $('body').delegate(self.SectionController, 'click', self.sectionLayoutaction.bind(this));\r\n        $(\"body\").delegate(self.RestrictInfo, \"click\", self.moduleHandler.bind(this));\r\n        $(\"body\").delegate(self.sectionRestricted, \"click\", this.sectionRestrictHandler.bind(this));\r\n        $('body').delegate(self.fullDescription, \"click\", self.fullmodcontentHandler.bind(this));\r\n        $('body').delegate(self.trimDescription, \"click\", self.trimmodcontentHandler.bind(this));\r\n        $('body').on('click keypress', SELECTOR.ACTIVITYLI + ' ' +\r\n        SELECTOR.ACTIVITYACTION + '[data-action]', this.editModuleRenderer.bind(this));\r\n        $('body').delegate(self.goToURL, \"click\", self.redirectToModule.bind(this));\r\n        window.onhashchange = function() {\r\n            self.expandSection();\r\n        };\r\n        this.expandSection();\r\n        if ($('.course-type-flow').length > 0) {\r\n            $('.collapse').on('show.bs.collapse', function() {\r\n                $(this).parents('li.section').addClass('stack-header-collapsing');\r\n                var sectionid = $(this).parents('li.section').attr('id');\r\n                var section = document.getElementById(sectionid);\r\n                var distance = section.offsetTop - document.body.scrollTop;\r\n                setTimeout(() => window.scroll(0, distance), 50);\r\n            }).on('shown.bs.collapse', function() {\r\n                $(this).parents('li.section').removeClass('stack-header-collapsing');\r\n            });\r\n        }\r\n        var contactModal = document.getElementsByClassName('toggle-contact-button');\r\n        Array.from(contactModal).forEach(function(element) {\r\n            element.addEventListener('click', function(e) {\r\n                e.preventDefault();\r\n                if (e.currentTarget.dataset.userid != undefined) {\r\n                    Contact.enhance(e.currentTarget);\r\n                }\r\n            });\r\n        });\r\n        $('.progress .progress-bar[data-toggle=\"popover\"]').popover();\r\n    };\r\n\r\n    /**\r\n     * Selector section controller.\r\n     */\r\n    DesignerSection.prototype.goToURL = '.designer [data-action=\"go-to-url\"]';\r\n\r\n    DesignerSection.prototype.SectionController = \".designer #section-designer-action .dropdown-menu a\";\r\n\r\n    DesignerSection.prototype.RestrictInfo = \".designer .designer-section-content .call-action-block\";\r\n\r\n    DesignerSection.prototype.moduleBlock = \".designer .designer-section-content li.activity\";\r\n\r\n    DesignerSection.prototype.loadingElement = \".icon-loader-block\";\r\n\r\n    DesignerSection.prototype.sectionRestricted = \".designer .availability-section-block .section-restricted-action\";\r\n\r\n    DesignerSection.prototype.moduleDescription = \".designer .designer-section-content li .mod-description-action\";\r\n\r\n    DesignerSection.prototype.fullDescription = \".designer-section-content li .fullcontent-summary .mod-description-action\";\r\n\r\n    DesignerSection.prototype.trimDescription = \".designer-section-content li .trim-summary .mod-description-action\";\r\n\r\n    DesignerSection.prototype.modules = null;\r\n\r\n    DesignerSection.prototype.addSectionSpinner = function(sectioninfo) {\r\n        var sectionelement = $(sectioninfo).addClass('editinprogress');\r\n        var actionarea = sectionelement.find('li.section').get(0);\r\n        if (actionarea) {\r\n            var spinner = M.util.add_spinner(Y, Y.Node(actionarea));\r\n            spinner.show();\r\n            return spinner;\r\n        }\r\n        return null;\r\n    };\r\n\r\n\r\n    DesignerSection.prototype.redirectToModule = function(event) {\r\n        let nodeName = event.target.nodeName;\r\n        let preventionNodes = ['a', 'button', 'form'];\r\n        let iscircle = event.target.closest('li.activity').classList.contains('circle-layout');\r\n        let isDescription = event.target.classList.contains('mod-description-action');\r\n        let isPadlock = event.target.classList.contains('fa-lock');\r\n        let ispopupModule = event.target.closest('li.activity').classList.contains('popmodule');\r\n        if ((nodeName in preventionNodes)\r\n            || document.body.classList.contains('editing') || iscircle || isDescription || isPadlock || ispopupModule) {\r\n            if (ispopupModule && !document.body.classList.contains('editing')) {\r\n                var li = event.target.closest('li.activity');\r\n                li.querySelector('a[href]').click();\r\n                // Event.target.closest('a').click();\r\n            }\r\n            return null;\r\n        }\r\n        var card = event.target.closest(\"[data-action=go-to-url]\");\r\n        let modurl = card.getAttribute('data-url');\r\n        window.location.href = modurl;\r\n        return true;\r\n    };\r\n\r\n    DesignerSection.prototype.expandSection = () => {\r\n        // Alert();\r\n        var sectionID = window.location.hash;\r\n        if (sectionID) {\r\n            var id = sectionID.substring(1);\r\n            var section = document.getElementById(id);\r\n            if (section) {\r\n                var title = section.querySelector('.section-header-content');\r\n                if (title) {\r\n                    title.classList.remove('collapsed');\r\n                    title.setAttribute('aria-expanded', true);\r\n                }\r\n                var content = section.querySelector('.content');\r\n                if (content) {\r\n                    content.classList.add('show');\r\n                }\r\n                if (document.getElementById('section-course-accordion') !== null) {\r\n                    document.getElementById('section-head-0').classList.add('collapsed');\r\n                    document.getElementById('section-content-0').classList.remove('show');\r\n                }\r\n                section.scrollIntoView();\r\n            }\r\n        }\r\n    };\r\n\r\n    DesignerSection.prototype.removeSectionSpinner = function(sectioninfo, spinner, delay) {\r\n        var element = $(sectioninfo);\r\n        window.setTimeout(function() {\r\n            element.removeClass('editinprogress');\r\n            if (spinner) {\r\n                spinner.hide();\r\n            }\r\n        }, delay);\r\n    };\r\n\r\n    /**\r\n     * Wrapper for Y.Moodle.core_course.util.cm.getId\r\n     *\r\n     * @param {JQuery} element\r\n     * @returns {Integer}\r\n     */\r\n     DesignerSection.prototype.getModuleId = function(element) {\r\n        var id;\r\n        Y.use('moodle-course-util', function(Y) {\r\n            id = Y.Moodle.core_course.util.cm.getId(Y.Node(element.get(0)));\r\n        });\r\n        return id;\r\n    };\r\n\r\n    DesignerSection.prototype.refreshSectionInfo = function(target) {\r\n        var self = this;\r\n        let sectioninfo = target.currentTarget.closest(\"li.section\");\r\n        let sectionId = $(sectioninfo).attr('data-id');\r\n        let sectionReturn = $(sectioninfo).attr('data-sectionreturnid');\r\n        var spinner = self.addSectionSpinner(sectioninfo);\r\n        var args = {\r\n            courseid: self.courseId,\r\n            sectionid: sectionId,\r\n            sectionreturn: sectionReturn\r\n        };\r\n        window.setTimeout(function(args) {\r\n            var promises = Ajax.call([{\r\n                methodname: 'format_designer_section_refresh',\r\n                args: args\r\n            }], true);\r\n            $.when.apply($, promises)\r\n                .done(function(dataencoded) {\r\n                    var data = $.parseJSON(dataencoded);\r\n                    if (data.modules !== undefined) {\r\n                        for (var i in data.modules) {\r\n                            self.replaceActivityhtml(data.modules[i]);\r\n                        }\r\n                    }\r\n                });\r\n\r\n        }, 1000, args);\r\n        self.removeSectionSpinner(sectioninfo, spinner, 400);\r\n    };\r\n\r\n    DesignerSection.prototype.editModuleRenderer = function(event) {\r\n        var self = this;\r\n        if (event.type === 'keypress' && event.keyCode !== 13) {\r\n            return;\r\n        }\r\n        var actionItem = $(event.currentTarget),\r\n        moduleElement = actionItem.closest(SELECTOR.ACTIVITYLI),\r\n        action = actionItem.attr('data-action'),\r\n        moduleId = self.getModuleId(moduleElement);\r\n        switch (action) {\r\n            case 'moveleft':\r\n            case 'moveright':\r\n            case 'delete':\r\n            case 'duplicate':\r\n            case 'hide':\r\n            case 'stealth':\r\n            case 'show':\r\n            case 'groupsseparate':\r\n            case 'groupsvisible':\r\n            case 'groupsnone':\r\n                break;\r\n            default:\r\n                // Nothing to do here!\r\n                return;\r\n        }\r\n        if (!moduleId) {\r\n            return;\r\n        }\r\n        event.preventDefault();\r\n        if (action === 'delete') {\r\n            // Deleting requires confirmation.\r\n            window.setTimeout(function() {\r\n                $('.modal-footer button[data-action=\"save\"]').click(function() {\r\n                    self.refreshSectionInfo(event);\r\n                });\r\n            }, 500);\r\n        } else {\r\n            self.refreshSectionInfo(event);\r\n        }\r\n    };\r\n\r\n    DesignerSection.prototype.fullmodcontentHandler = function(event) {\r\n        var THIS = $(event.currentTarget);\r\n        let fullContent = $(THIS).closest('li.activity').find('.fullcontent-summary');\r\n        let trimcontent = $(THIS).closest('li.activity').find('.trim-summary');\r\n        if (trimcontent.hasClass('summary-hide')) {\r\n            trimcontent.removeClass('summary-hide');\r\n            fullContent.addClass('summary-hide');\r\n        }\r\n    };\r\n\r\n    DesignerSection.prototype.trimmodcontentHandler = function(event) {\r\n        var THIS = $(event.currentTarget);\r\n        let fullContent = $(THIS).closest('li.activity').find('.fullcontent-summary');\r\n        let trimcontent = $(THIS).closest('li.activity').find('.trim-summary');\r\n        if (fullContent.hasClass('summary-hide')) {\r\n            fullContent.removeClass('summary-hide');\r\n            trimcontent.addClass('summary-hide');\r\n        }\r\n    };\r\n\r\n    DesignerSection.prototype.sectionRestrictHandler = function(event) {\r\n        var sectionRestrictInfo = $(event.currentTarget).prev();\r\n        if (sectionRestrictInfo) {\r\n            if (!sectionRestrictInfo.hasClass('show')) {\r\n                sectionRestrictInfo.addClass('show');\r\n            } else {\r\n                sectionRestrictInfo.removeClass('show');\r\n            }\r\n        }\r\n    };\r\n\r\n    DesignerSection.prototype.moduleHandler = function(event) {\r\n        event.preventDefault();\r\n        var restrictBlock = $(event.currentTarget).parents('.restrict-block');\r\n        if (restrictBlock.length) {\r\n            if (!restrictBlock.hasClass('show')) {\r\n                restrictBlock.addClass('show');\r\n            } else {\r\n                restrictBlock.removeClass('show');\r\n            }\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Implementaion swith the section layout.\r\n     * @param {object} event\r\n     */\r\n    DesignerSection.prototype.sectionLayoutaction = function(event) {\r\n        var self = this;\r\n        let sectionId = event.target.closest('li.section').getAttribute('id');\r\n        var iconBlock = \"#\" + sectionId + \" \" + self.loadingElement;\r\n        var layout = $(event.currentTarget).data('value');\r\n        var layouttext = $(event.currentTarget).text();\r\n        $(event.target).parents(\".dropdown\").find(\".btn\").html(layouttext);\r\n        $(event.target).parents(\".dropdown\").find(\".btn\").val(layout);\r\n        $(event.target).parent().find(\"a.dropdown-item\").each(function() {\r\n            $(this).removeClass('active');\r\n        });\r\n        $(event.target).addClass('active');\r\n        let dataid = event.target.closest('li.section').getAttribute('data-id');\r\n        var args = {\r\n            courseid: self.courseId,\r\n            sectionid: dataid,\r\n            options: [{name: $(event.currentTarget).data('option'), value: layout}]\r\n        };\r\n        var ULClasses = {\r\n            'cards': 'card-deck card-layout',\r\n            'list': 'list-layout',\r\n            'default': 'link-layout',\r\n            'circles': 'circles-layout',\r\n            'horizontal_circles': 'circles-layout horizontal-circles-layout'\r\n\r\n        };\r\n        var promises = Ajax.call([{\r\n                methodname: 'format_designer_set_section_options',\r\n                args: args\r\n            }], true);\r\n        $.when.apply($, promises)\r\n            .done(function(dataencoded) {\r\n                var data = $.parseJSON(dataencoded);\r\n                if (data.modules !== undefined) {\r\n                    for (var i in data.modules) {\r\n                        self.replaceActivityhtml(data.modules[i]);\r\n                    }\r\n                    document.getElementById(sectionId).classList.forEach((className) => {\r\n                        if (className.startsWith('section-type-')) {\r\n                            document.getElementById(sectionId).classList.remove(className);\r\n                        }\r\n                    });\r\n                    document.getElementById(sectionId).classList.add('section-type-' + layout);\r\n                    $('#' + sectionId).find('ul.section').removeClass(ULClasses.cards);\r\n                    $('#' + sectionId).find('ul.section').removeClass(ULClasses.list);\r\n                    $('#' + sectionId).find('ul.section').removeClass(ULClasses.default);\r\n                    $('#' + sectionId).find('ul.section').removeClass(ULClasses.circles);\r\n                    $('#' + sectionId).find('ul.section').removeClass(ULClasses.horizontal_circles);\r\n                    $('#' + sectionId).find('ul.section').addClass(ULClasses[layout]);\r\n                }\r\n            });\r\n        Loadingicon.addIconToContainerRemoveOnCompletion(iconBlock, promises);\r\n    };\r\n\r\n    /**\r\n     * Replaces the course module with the new html (used to update module after it was edited or its visibility was changed).\r\n     *\r\n     * @param {String} activityHTML\r\n     */\r\n    DesignerSection.prototype.replaceActivityhtml = function(activityHTML) {\r\n        $('<div>' + activityHTML + '</div>').find(SELECTOR.ACTIVITYLI).each(function() {\r\n            // Extract id from the new activity html.\r\n            var id = $(this).attr('id');\r\n            // Find the existing element with the same id and replace its contents with new html.\r\n            $(SELECTOR.ACTIVITYLI + '#' + id).replaceWith(activityHTML);\r\n            // Initialise action menu.\r\n            initActionMenu(id);\r\n        });\r\n    };\r\n\r\n    /**\r\n     * Initialise action menu for the element (section or module)\r\n     *\r\n     * @param {String} elementid CSS id attribute of the element\r\n     */\r\n    var initActionMenu = function(elementid) {\r\n        // Initialise action menu in the new activity.\r\n        Y.use('moodle-course-coursebase', function() {\r\n            M.course.coursebase.invoke_function('setup_for_resource', '#' + elementid);\r\n        });\r\n        if (M.core.actionmenu && M.core.actionmenu.newDOMNode) {\r\n            M.core.actionmenu.newDOMNode(Y.one('#' + elementid));\r\n        }\r\n    };\r\n\r\n    return {\r\n        init: function(courseId, contextId, popupActivities) {\r\n            return new DesignerSection(courseId, contextId, popupActivities);\r\n        }\r\n    };\r\n});"],"names":["define","$","Fragment","Templates","Loadingicon","Ajax","Contact","SELECTOR","ACTIVITYLI","SECTIONLI","ACTIVITYACTION","SECTIONACTIONMENU","Y","use","courseformatselector","M","course","format","get_section_selector","DesignerSection","courseId","contextId","popupActivities","self","this","addClass","delegate","SectionController","sectionLayoutaction","bind","RestrictInfo","moduleHandler","sectionRestricted","sectionRestrictHandler","fullDescription","fullmodcontentHandler","trimDescription","trimmodcontentHandler","on","editModuleRenderer","goToURL","redirectToModule","window","onhashchange","expandSection","length","parents","sectionid","attr","distance","document","getElementById","offsetTop","body","scrollTop","setTimeout","scroll","removeClass","contactModal","getElementsByClassName","Array","from","forEach","element","addEventListener","e","preventDefault","undefined","currentTarget","dataset","userid","enhance","popover","prototype","moduleBlock","loadingElement","moduleDescription","modules","addSectionSpinner","sectioninfo","sectionelement","actionarea","find","get","spinner","util","add_spinner","Node","show","event","nodeName","target","iscircle","closest","classList","contains","isDescription","isPadlock","ispopupModule","querySelector","click","card","modurl","getAttribute","location","href","sectionID","hash","id","substring","section","title","remove","setAttribute","content","add","scrollIntoView","removeSectionSpinner","delay","hide","getModuleId","Moodle","core_course","cm","getId","refreshSectionInfo","sectionId","sectionReturn","args","courseid","sectionreturn","promises","call","methodname","when","apply","done","dataencoded","data","parseJSON","i","replaceActivityhtml","type","keyCode","actionItem","moduleElement","action","moduleId","THIS","fullContent","trimcontent","hasClass","sectionRestrictInfo","prev","restrictBlock","iconBlock","layout","layouttext","text","html","val","parent","each","dataid","options","name","value","ULClasses","cards","list","default","circles","horizontal_circles","className","startsWith","addIconToContainerRemoveOnCompletion","activityHTML","replaceWith","initActionMenu","elementid","coursebase","invoke_function","core","actionmenu","newDOMNode","one","init"],"mappings":"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"}