{"version":3,"sources":["../src/designer_section.js"],"names":["define","$","Fragment","Templates","Loadingicon","DesignerSection","courseId","contextId","self","designerSelectorSections","document","querySelectorAll","SectionController","forEach","item","addEventListener","sectionLayoutaction","bind","moduleBlock","on","moduleHandler","prototype","event","preventDefault","target","parents","length","modUrl","currentTarget","closest","attr","window","open","restrictBlock","find","hasClass","addClass","removeClass","sectionId","getAttribute","iconBlock","loadingElement","addIconToContainerWithPromise","layout","data","layouttext","text","html","val","parent","each","sectionnumber","args","courseid","sectioncol","sectioncolvalue","loadFragment","done","js","updateId","replaceNode","empty","RestrictInfo","init"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Implemented designer format js.\n *\n * @module     format_designer/designer_section\n * @copyright  2021 bdecent gmbh <https://bdecent.de>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n define(['jquery', 'core/fragment', 'core/templates', 'core/loadingicon'],\n function($, Fragment, Templates, Loadingicon) {\n    /**\n     * Control designer format action\n     * @param {int} courseId\n     * @param {int} contextId\n     */\n    let DesignerSection = function(courseId, contextId) {\n        var self = this;\n        self.courseId = courseId;\n        self.contextId = contextId;\n        var designerSelectorSections = document.querySelectorAll(this.SectionController + \" .dropdown-menu a\");\n         if (designerSelectorSections) {\n            designerSelectorSections.forEach(function(item) {\n                item.addEventListener('click', self.sectionLayoutaction.bind(self));\n            });\n        }\n        $(self.moduleBlock).on(\"click\", \"li .card-body\", this.moduleHandler.bind(this));\n    };\n\n    DesignerSection.prototype.moduleHandler = function(event) {\n        event.preventDefault();\n        if ($(event.target).parents(\".call-action-block\").length == 0) {\n            var modUrl = $(event.currentTarget).closest('.card').attr('data-url');\n            if (modUrl) {\n                window.open(modUrl, '_self');\n            }\n        } else {\n            var restrictBlock = $(event.currentTarget).find(\".restrict-block\");\n            if (restrictBlock) {\n                if (!restrictBlock.hasClass('show')) {\n                    restrictBlock.addClass('show');\n                } else {\n                    restrictBlock.removeClass('show');\n                }\n            }\n        }\n    };\n\n    /**\n     * Implementaion swith the section layout.\n     * @param {object} event\n     */\n    DesignerSection.prototype.sectionLayoutaction = function(event) {\n        var self = this;\n        let sectionId = event.target.closest('li.section').getAttribute('id');\n        var iconBlock = \"#\" + sectionId + \" \" + self.loadingElement;\n        Loadingicon.addIconToContainerWithPromise(iconBlock);\n        var layout = $(event.currentTarget).data('value');\n        var layouttext = $(event.currentTarget).text();\n        $(event.target).parents(\".dropdown\").find(\".btn\").html(layouttext);\n        $(event.target).parents(\".dropdown\").find(\".btn\").val(layout);\n        $(event.target).parent().find(\"a.dropdown-item\").each(function() {\n            $(this).removeClass('active');\n        });\n        $(event.target).addClass('active');\n        let sectionnumber = event.target.closest('li.section').getAttribute('data-sectionid');\n        var args = {\n            courseid: self.courseId,\n            sectionnumber: sectionnumber,\n            sectioncol: $(event.currentTarget).data('option'),\n            sectioncolvalue: layout\n        };\n        Fragment.loadFragment('format_designer', 'get_section_modules', self.contextId, args).done((html, js) => {\n            if (html) {\n                var updateId = `.course-content .designer #section-${sectionnumber} #designer-section-content`;\n                Templates.replaceNode(updateId, html, js);\n                $(iconBlock).empty();\n                $(self.moduleBlock).on(\"click\", \"li .card-body\", self.moduleHandler.bind(this));\n            }\n        });\n    };\n\n    /**\n     * Selector section controller.\n     */\n    DesignerSection.prototype.SectionController = \".designer #section-designer-action\";\n\n    DesignerSection.prototype.RestrictInfo = \".designer #designer-section-content .call-action-block\";\n\n    DesignerSection.prototype.moduleBlock = \".designer #designer-section-content\";\n\n    DesignerSection.prototype.loadingElement = \".icon-loader-block\";\n\n    return {\n        init: function(courseId, contextId) {\n            return new DesignerSection(courseId, contextId);\n        }\n    };\n});"],"file":"designer_section.min.js"}